==================================================
퀀트 투자 전략 백테스팅 및 분석을 시작합니다.
분석 기간: 20230101 ~ 20231231
매매 모드: monthly
로그 파일: logs\backtest_log_20251211_184154.txt
==================================================
Step 1: 월별 유동성 풀 구성 및 필요 Ticker를 취합합니다...
 -> 리밸런싱 날짜: 12개 (['20230102', '20230201', '20230302', '20230403', '20230502', '20230601', '20230703', '20230801', '20230901', '20231004', '20231101', '20231201'])
 -> 총 314개의 ETF에 대한 데이터가 필요합니다.

Step 2: 필요한 모든 OHLCV 데이터를 한번에 수집합니다...
 -> OHLCV 데이터 수집 완료. (실패: 0개)
 -> ✓ 캐시 저장 완료: ohlcv_cache_20220101_20231231_314.pkl

Step 3: 백테스팅 시뮬레이션을 시작합니다...
✓ 벤치마크 데이터 확인: 069500 (490개 데이터)

============================================================
[20230102] 월별 포트폴리오 구성 상세
============================================================

  [Conservative 전략 실행]
  자산 배분 원칙: 각 자산군 대표 ETF 1개씩 (유동성 기준)
    - 해외주식(시장): SOL 미국배당다우존스 (446720) - 거래대금: 49.4억
    - 국내주식(코스피): KODEX 200 (069500) - 거래대금: 1663.9억
    - 국내채권: RISE KIS국고채30년Enhanced (385560) - 거래대금: 37.1억
    - 대체자산: 후보 없음
  → 최종 구성: 3개 종목

  [Aggressive 전략 실행]
  자산 배분 원칙: 변동성/베타 상위 종목 (다층 리스크 필터)
    ✓ 시장 상태: 정상 (리스크 신호 1개)
      경고: MA200 추세 반전 (현재: 29420.00 < MA200: 32417.17)
      → 공격 모드: 모멘텀 종목 편입
    → 포트폴리오: 공격자산 3개 + 안전자산 1개

  [Neutral 전략 실행]
  팩터 분산 원칙: 시장/성장/안정/인플레이션헷지 균형
    - 시장: KODEX 200 (069500) - 국내주식(코스피)
    - 성장: KODEX 코스닥150 (229200) - 국내주식(코스닥)
    - 안정: KODEX 고배당주 (279530) - 국내주식(스타일)
    - 인플레이션헷지: 후보 없음
  → 최종 구성: 3개 종목

============================================================

============================================================
[20231201] 월별 포트폴리오 구성 상세
============================================================

  [Conservative 전략 실행]
  자산 배분 원칙: 각 자산군 대표 ETF 1개씩 (유동성 기준)
    - 해외주식(시장): TIGER 미국S&P500 (360750) - 거래대금: 102.6억
    - 국내주식(코스피): KODEX 200 (069500) - 거래대금: 1677.0억
    - 국내채권: KODEX 국고채10년액티브 (471230) - 거래대금: 169.7억
    - 대체자산: TIGER 리츠부동산인프라 (329200) - 거래대금: 20.3억
  → 최종 구성: 4개 종목

  [Aggressive 전략 실행]
  자산 배분 원칙: 변동성/베타 상위 종목 (다층 리스크 필터)
    ⚠️ 방어 신호 감지: 2개 (임계값: 2개 이상)
      - 변동성 급증 (현재: 0.0137 > 기준: 0.0123)
      - 모멘텀 약화 (3개월 수익률: -1.63%)
      → 방어 모드: 안전자산 비중 확대
    → 포트폴리오: 안전자산 3개 + 공격자산 1개

  [Neutral 전략 실행]
  팩터 분산 원칙: 시장/성장/안정/인플레이션헷지 균형
    - 시장: KODEX 200 (069500) - 국내주식(코스피)
    - 성장: KODEX 코스닥150 (229200) - 국내주식(코스닥)
    - 안정: KODEX 국고채10년액티브 (471230) - 국내채권
    - 인플레이션헷지: TIGER 리츠부동산인프라 (329200) - 대체자산
  → 최종 구성: 4개 종목

============================================================

생성된 포트폴리오 월: ['202301', '202302', '202303', '202304', '202305', '202306', '202307', '202308', '202309', '202310', '202311', '202312']

Step 4: 일별 포트폴리오 가치를 계산합니다...

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0070 ~ 0.0129
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0066 ~ 0.0129
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0066 ~ 0.0129
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0062 ~ 0.0129
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0066 ~ 0.0129
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0062 ~ 0.0129
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0066 ~ 0.0129
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0062 ~ 0.0129
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0062 ~ 0.0129
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0062 ~ 0.0129
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0066 ~ 0.0129
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0047 ~ 0.0106
    - 가중치 합계: 100.00%

  [conservative] 거래 비용 통계:
    - 거래수수료: 150,741원 (0.151%)
    - 슬리피지: 75,371원 (0.075%)
    - 총 비용: 226,112원 (0.226%)
    - 최종 자산: 109,182,641원

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [aggressive] 거래 비용 통계:
    - 거래수수료: 249,426원 (0.249%)
    - 슬리피지: 124,713원 (0.125%)
    - 총 비용: 374,140원 (0.374%)
    - 최종 자산: 144,841,537원

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0057 ~ 0.0240
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0072 ~ 0.0240
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0106 ~ 0.0240
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0062 ~ 0.0240
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0071 ~ 0.0240
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0062 ~ 0.0240
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0091 ~ 0.0240
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0062 ~ 0.0240
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0062 ~ 0.0240
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0062 ~ 0.0240
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0071 ~ 0.0450
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0047 ~ 0.0240
    - 가중치 합계: 100.00%

  [neutral] 거래 비용 통계:
    - 거래수수료: 241,285원 (0.241%)
    - 슬리피지: 120,643원 (0.121%)
    - 총 비용: 361,928원 (0.362%)
    - 최종 자산: 113,599,895원

벤치마크 계산 기간: 2023-01-02 ~ 2023-12-28
벤치마크 데이터 포인트: 245개
  ✓ BM_KOSPI200 계산 완료: 245개 데이터
  ✓ BM_MultiAsset (Conservative용) 계산 완료: 245개 데이터
  ✓ BM_HighVolatility (Aggressive용) 계산 완료: 245개 데이터
  ✓ BM_MarketTrend (MA200) 계산 완료: 245개 데이터
  ✓ BM_FactorBalance (Neutral용) 계산 완료: 245개 데이터

데이터 검증 중...
  ⚠️  BM_KOSPI_MA200: 199개 NaN 값 발견 → 제거
  ✓ 최종 데이터 기간: 2023-01-02 ~ 2023-12-28
  ✓ 데이터 포인트: 245개
  ✓ BM_KOSPI200: 245/245 유효 데이터

==================================================
전략별 포트폴리오 구성 요약
==================================================

[CONSERVATIVE]
  리밸런싱 횟수: 12회
  기간: 202301 ~ 202312
  평균 보유 종목 수: 3.8개
  가장 자주 편입된 종목 (Top 3):
    - 069500: 12회 (100.0%)
    - 385560: 11회 (91.7%)
    - 360750: 11회 (91.7%)

[AGGRESSIVE]
  리밸런싱 횟수: 12회
  기간: 202301 ~ 202312
  평균 보유 종목 수: 4.0개
  가장 자주 편입된 종목 (Top 3):
    - 423160: 10회 (83.3%)
    - 388420: 8회 (66.7%)
    - 314250: 7회 (58.3%)

[NEUTRAL]
  리밸런싱 횟수: 12회
  기간: 202301 ~ 202312
  평균 보유 종목 수: 3.8개
  가장 자주 편입된 종목 (Top 3):
    - 069500: 12회 (100.0%)
    - 229200: 12회 (100.0%)
    - 329200: 6회 (50.0%)

--- 핵심 성과 지표 (KPI) ---
                    누적수익률    CAGR 최대낙폭(MDD)  샤프지수     승률  연평균회전율
conservative        9.22%   9.36%    -9.31%  1.09  53.7%  242.9%
aggressive         44.89%  45.67%   -11.09%  2.64  55.7%  463.6%
neutral            13.63%  13.85%   -12.36%  1.13  52.5%  361.0%
BM_KOSPI200        22.94%  23.31%   -12.91%  1.43  54.1%     NaN
BM_MultiAsset      17.16%  17.43%    -3.52%  2.78  57.4%     NaN
BM_HighVolatility  45.74%  46.54%   -26.72%  1.37  54.5%     NaN
BM_KOSPI_MA200      0.95%   0.96%     0.00%  6.08  18.4%     NaN
BM_FactorBalance   22.27%  22.63%    -8.74%  1.94  53.7%     NaN

==================================================
월별 성과 분석 중...
==================================================

--- 월별 수익률 통계 ---
                   평균 월수익률  월수익률 표준편차  최고 월수익률  최저 월수익률  양(+)의 월 비율
conservative          0.51       3.00     5.53    -4.98       72.73
aggressive            2.82       5.57     9.32    -5.93       63.64
neutral               0.58       3.84     6.46    -5.40       54.55
BM_KOSPI200           1.18       4.79    10.75    -6.74       45.45
BM_MultiAsset         1.19       1.85     3.92    -1.54       81.82
BM_HighVolatility     3.30       9.96    17.17   -13.32       72.73
BM_KOSPI_MA200        0.09       0.19     0.58     0.00       27.27
BM_FactorBalance      1.49       3.52     6.47    -4.11       63.64

==================================================
시각화 자료 생성 중...
==================================================
  [1/6] 전략별 누적 수익률 차트 생성 (매매 시점 포함)...
  [2/6] 월별 수익률 히트맵 생성...
  [4/7] 드로우다운 차트 생성...
  [3/6] 드로우다운 차트 생성...
  [4/5] 월별 포트폴리오 구성 파이 차트 생성...
    → 안정추구형 파이 차트 저장 완료
    → 공격투자형 파이 차트 저장 완료
    → 위험중립형 파이 차트 저장 완료
  [5/5] 월별/분기별 성과 분해 차트 생성...

==================================================
성과 분해 요약 (Performance Attribution)
==================================================

[CONSERVATIVE]
  최고 성과 월: 2023-11 (+5.53%) - 강세
  최저 성과 월: 2023-10 (-4.98%) - 급락

[AGGRESSIVE]
  최고 성과 월: 2023-07 (+9.32%) - 강세
  최저 성과 월: 2023-09 (-5.93%) - 급락

[NEUTRAL]
  최고 성과 월: 2023-11 (+6.46%) - 강세
  최저 성과 월: 2023-10 (-5.40%) - 급락

'results' 폴더에 모든 분석 결과가 저장되었습니다.

생성된 파일 목록:
  - kpi_summary_monthly.csv
  - monthly_stats_monthly.csv
  - monthly_attribution_monthly.csv (NEW)
  - quarterly_attribution_monthly.csv (NEW)
  - cumulative_returns_monthly.png (전략별 개별 + 매매 시점)

'results' 폴더에 모든 분석 결과가 저장되었습니다.

생성된 파일 목록:
  - kpi_summary_monthly.csv
  - monthly_stats_monthly.csv
  - monthly_attribution_monthly.csv
  - quarterly_attribution_monthly.csv
  - cumulative_returns_monthly.png (전략별 개별 + 매매 시점)
  - monthly_heatmap_monthly.png
  - drawdown_monthly.png
  - portfolio_composition_monthly_*.png (전략별)
  - performance_attribution_monthly.png

모든 프로세스가 완료되었습니다.

📋 로그 파일이 저장되었습니다: logs\backtest_log_20251211_184154.txt

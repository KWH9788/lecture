==================================================
퀀트 투자 전략 백테스팅 및 분석을 시작합니다.
분석 기간: 20240101 ~ 20241231
매매 모드: monthly
로그 파일: logs\backtest_log_20251211_173245.txt
==================================================
Step 1: 월별 유동성 풀 구성 및 필요 Ticker를 취합합니다...
 -> 리밸런싱 날짜: 12개 (['20240102', '20240201', '20240304', '20240401', '20240502', '20240603', '20240701', '20240801', '20240902', '20241002', '20241101', '20241202'])
 -> 총 442개의 ETF에 대한 데이터가 필요합니다.

Step 2: 필요한 모든 OHLCV 데이터를 한번에 수집합니다...
 -> 캐시 파일 발견: ohlcv_cache_20230101_20241231_442.pkl (생성: 6일 전)
 -> 캐시에서 데이터를 불러오는 중...
 -> ✓ 캐시 데이터 로드 완료! (3536개 컬럼)

Step 3: 백테스팅 시뮬레이션을 시작합니다...
✓ 벤치마크 데이터 확인: 069500 (488개 데이터)

============================================================
[20240102] 월별 포트폴리오 구성 상세
============================================================

  [Conservative 전략 실행]
  자산 배분 원칙: 각 자산군 대표 ETF 1개씩 (유동성 기준)
    - 해외주식(시장): TIGER 미국S&P500 (360750) - 거래대금: 272.4억
    - 국내주식(코스피): KODEX 200 (069500) - 거래대금: 2686.6억
    - 국내채권: RISE KIS국고채30년Enhanced (385560) - 거래대금: 118.3억
    - 대체자산: TIGER 리츠부동산인프라 (329200) - 거래대금: 39.7억
  → 최종 구성: 4개 종목

  [Aggressive 전략 실행]
  자산 배분 원칙: 변동성/베타 상위 종목 (다층 리스크 필터)
    ✓ 시장 상태: 정상 (리스크 신호 0개)
      → 공격 모드: 모멘텀 종목 편입
    → 포트폴리오: 공격자산 3개 + 안전자산 1개

  [Neutral 전략 실행]
  팩터 분산 원칙: 시장/성장/안정/인플레이션헷지 균형
    - 시장: KODEX 200 (069500) - 국내주식(코스피)
    - 성장: KODEX 코스닥150 (229200) - 국내주식(코스닥)
    - 안정: RISE KIS국고채30년Enhanced (385560) - 국내채권
    - 인플레이션헷지: TIGER 리츠부동산인프라 (329200) - 대체자산
  → 최종 구성: 4개 종목

============================================================

============================================================
[20241202] 월별 포트폴리오 구성 상세
============================================================

  [Conservative 전략 실행]
  자산 배분 원칙: 각 자산군 대표 ETF 1개씩 (유동성 기준)
    - 해외주식(시장): TIGER 미국S&P500 (360750) - 거래대금: 1073.5억
    - 국내주식(코스피): KODEX 200 (069500) - 거래대금: 2409.7억
    - 국내채권: RISE 국고채10년액티브 (481430) - 거래대금: 146.4억
    - 대체자산: ACE KRX금현물 (411060) - 거래대금: 105.7억
  → 최종 구성: 4개 종목

  [Aggressive 전략 실행]
  자산 배분 원칙: 변동성/베타 상위 종목 (다층 리스크 필터)
    ⚠️ 방어 신호 감지: 2개 (임계값: 2개 이상)
      - MA200 추세 반전 (현재: 32700.00 < MA200: 36208.93)
      - 모멘텀 약화 (3개월 수익률: -9.82%)
      → 방어 모드: 안전자산 비중 확대
    → 포트폴리오: 안전자산 3개 + 공격자산 1개

  [Neutral 전략 실행]
  팩터 분산 원칙: 시장/성장/안정/인플레이션헷지 균형
    - 시장: KODEX 200 (069500) - 국내주식(코스피)
    - 성장: KODEX 코스닥150 (229200) - 국내주식(코스닥)
    - 안정: ACE 테슬라밸류체인액티브 (457480) - 국내주식(스타일)
    - 인플레이션헷지: ACE KRX금현물 (411060) - 대체자산
  → 최종 구성: 4개 종목

============================================================

생성된 포트폴리오 월: ['202401', '202402', '202403', '202404', '202405', '202406', '202407', '202408', '202409', '202410', '202411', '202412']

Step 4: 일별 포트폴리오 가치를 계산합니다...

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0078 ~ 0.0150
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0033 ~ 0.0150
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0078 ~ 0.0150
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0078 ~ 0.0150
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0012 ~ 0.0150
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0033 ~ 0.0150
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0023 ~ 0.0150
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0033 ~ 0.0150
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0023 ~ 0.0150
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0078 ~ 0.0150
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0012 ~ 0.0150
    - 가중치 합계: 100.00%

  [가중치 계산: CONSERVATIVE]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0033 ~ 0.0150
    - 가중치 합계: 100.00%

  [conservative] 거래 비용 통계:
    - 거래수수료: 324,263원 (0.324%)
    - 슬리피지: 162,132원 (0.162%)
    - 총 비용: 486,395원 (0.486%)
    - 최종 자산: 103,051,530원

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [가중치 계산: AGGRESSIVE]
    - 안전자산: 0개 | 공격자산: 4개
    - 모드: 공격 (80/20)
    - 가중치 합계: 100.00%

  [aggressive] 거래 비용 통계:
    - 거래수수료: 115,736원 (0.116%)
    - 슬리피지: 57,868원 (0.058%)
    - 총 비용: 173,605원 (0.174%)
    - 최종 자산: 79,958,824원

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0078 ~ 0.0213
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0097 ~ 0.0213
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0078 ~ 0.0213
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0093 ~ 0.0213
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0112 ~ 0.0391
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0093 ~ 0.0213
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0097 ~ 0.0213
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0097 ~ 0.0314
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0097 ~ 0.0213
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0097 ~ 0.0391
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0112 ~ 0.0213
    - 가중치 합계: 100.00%

  [가중치 계산: NEUTRAL]
    - 역변동성 가중 (과거 6개월 기준 - Meucci 2005)
    - 변동성 범위: 0.0112 ~ 0.0391
    - 가중치 합계: 100.00%

  [neutral] 거래 비용 통계:
    - 거래수수료: 220,924원 (0.221%)
    - 슬리피지: 110,462원 (0.110%)
    - 총 비용: 331,386원 (0.331%)
    - 최종 자산: 92,822,364원

벤치마크 계산 기간: 2024-01-02 ~ 2024-12-30
벤치마크 데이터 포인트: 244개
  ✓ BM_KOSPI200 계산 완료: 244개 데이터
  ✓ BM_MultiAsset (Conservative용) 계산 완료: 244개 데이터
  ✓ BM_HighVolatility (Aggressive용) 계산 완료: 244개 데이터
  ✓ BM_MarketTrend (MA200) 계산 완료: 244개 데이터
  ✓ BM_FactorBalance (Neutral용) 계산 완료: 244개 데이터

데이터 검증 중...
  ⚠️  BM_KOSPI_MA200: 199개 NaN 값 발견 → 제거
  ✓ 최종 데이터 기간: 2024-01-02 ~ 2024-12-30
  ✓ 데이터 포인트: 244개
  ✓ BM_KOSPI200: 244/244 유효 데이터

==================================================
전략별 포트폴리오 구성 요약
==================================================

[CONSERVATIVE]
  리밸런싱 횟수: 12회
  기간: 202401 ~ 202412
  평균 보유 종목 수: 4.0개
  가장 자주 편입된 종목 (Top 3):
    - 069500: 12회 (100.0%)
    - 360750: 11회 (91.7%)
    - 329200: 7회 (58.3%)

[AGGRESSIVE]
  리밸런싱 횟수: 12회
  기간: 202401 ~ 202412
  평균 보유 종목 수: 4.0개
  가장 자주 편입된 종목 (Top 3):
    - 423160: 11회 (91.7%)
    - 364980: 7회 (58.3%)
    - 461950: 7회 (58.3%)

[NEUTRAL]
  리밸런싱 횟수: 12회
  기간: 202401 ~ 202412
  평균 보유 종목 수: 4.0개
  가장 자주 편입된 종목 (Top 3):
    - 069500: 12회 (100.0%)
    - 229200: 11회 (91.7%)
    - 329200: 7회 (58.3%)

--- 핵심 성과 지표 (KPI) ---
                     누적수익률     CAGR 최대낙폭(MDD)   샤프지수     승률  연평균회전율
conservative         3.08%    3.10%    -3.83%   0.54  58.0%  463.6%
aggressive         -20.02%  -20.13%   -28.99%  -0.85  44.4%  300.0%
neutral             -7.15%   -7.19%   -17.44%  -0.40  51.4%  490.9%
BM_KOSPI200        -11.90%  -11.97%   -21.14%  -0.53  49.0%     NaN
BM_MultiAsset       18.07%   18.19%    -6.28%   2.00  56.0%     NaN
BM_HighVolatility  -19.75%  -19.86%   -30.61%  -0.67  49.4%     NaN
BM_KOSPI_MA200      -1.16%   -1.17%    -1.16%  -5.90   0.4%     NaN
BM_FactorBalance     3.03%    3.04%    -8.20%   0.32  53.1%     NaN

==================================================
월별 성과 분석 중...
==================================================

--- 월별 수익률 통계 ---
                   평균 월수익률  월수익률 표준편차  최고 월수익률  최저 월수익률  양(+)의 월 비율
conservative          0.36       1.66     3.06    -2.81       63.64
aggressive           -0.58       5.53     8.91    -8.70       45.45
neutral              -0.26       3.39     4.98    -3.84       36.36
BM_KOSPI200          -0.40       4.47     7.04    -4.79       27.27
BM_MultiAsset         1.58       2.38     6.59    -0.95       63.64
BM_HighVolatility    -0.69       6.67    12.46   -10.74       27.27
BM_KOSPI_MA200       -0.11       0.27     0.00    -0.90        0.00
BM_FactorBalance      0.74       3.32     7.21    -4.86       54.55

==================================================
시각화 자료 생성 중...
==================================================
  [1/7] 전략별 누적 수익률 차트 생성 (매매 시점 포함)...
  [2/7] 통합 누적 수익률 차트 생성...
  [3/7] 월별 수익률 히트맵 생성...
  [4/7] 드로우다운 차트 생성...
  [5/7] 월별 포트폴리오 구성 파이 차트 생성...
    → 안정추구형 파이 차트 저장 완료
    → 공격투자형 파이 차트 저장 완료
    → 위험중립형 파이 차트 저장 완료
  [6/7] 이동 평균 성과 차트 생성...
  [7/7] 월별/분기별 성과 분해 차트 생성...

==================================================
성과 분해 요약 (Performance Attribution)
==================================================

[CONSERVATIVE]
  최고 성과 월: 2024-03 (+3.06%) - 강세
  최저 성과 월: 2024-04 (-2.81%) - 급락

[AGGRESSIVE]
  최고 성과 월: 2024-02 (+8.91%) - 강세
  최저 성과 월: 2024-05 (-8.70%) - 급락

[NEUTRAL]
  최고 성과 월: 2024-02 (+4.98%) - 강세
  최저 성과 월: 2024-08 (-3.84%) - 급락

'results' 폴더에 모든 분석 결과가 저장되었습니다.

생성된 파일 목록:
  - kpi_summary_monthly.csv
  - monthly_stats_monthly.csv
  - monthly_attribution_monthly.csv (NEW)
  - quarterly_attribution_monthly.csv (NEW)
  - cumulative_returns_monthly.png (전략별 개별 + 매매 시점)
  - cumulative_returns_combined_monthly.png (통합)
  - monthly_heatmap_monthly.png
  - drawdown_monthly.png
  - portfolio_composition_monthly_*.png (전략별)
  - rolling_performance_monthly.png
  - performance_attribution_monthly.png (NEW)

모든 프로세스가 완료되었습니다.

📋 로그 파일이 저장되었습니다: logs\backtest_log_20251211_173245.txt
